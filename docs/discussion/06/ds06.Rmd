
---
title:  "STAT340: Discussion 6: More Hypothesis Testing"
author: "Names"
date:   "`r format(Sys.time(), '%d %B, %Y')`" # autogenerate date as date of last knit
documentclass: article
classoption: letterpaper
output:
  html_document:
    highlight: tango
    fig_caption: false
---

```{r setup, include=FALSE}
# if sourced, set working directory to file location
# added tryCatch in case knitting runs into error
tryCatch({
  if(Sys.getenv('RSTUDIO')=='1'){
    setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
  }}, error = function(e){}
)

# install necessary packages
if(!require(pacman)) install.packages("pacman")
pacman::p_load(knitr,tidyverse)

knitr::opts_chunk$set(tidy=FALSE,strip.white=FALSE,fig.align="center",comment=" #")
```

---

[Link to source file](ds06.Rmd)



## Just for fun (1 min)

<center><a href="https://xkcd.com/2118/"><img id="comic" src="https://imgs.xkcd.com/comics/normal_distribution.png" title="It's the NORMAL distribution, not the TANGENT distribution."></a></center>

<br/>



## Exercises

Since we haven't covered covered estimation yet, today we will explore more exercises relating to hypothesis testing. As usual, break off into **groups of 3-4 students**. In your group, nominate one person to share their screen.

This week, there are **two shorter exercises**, both of which you must complete.

---

<br/>




### 1. Gender gap in chess

Due to myriad complex biological factors (e.g. [higher average height](https://doi.org/10.1002/ajpa.1330530314), [higher skeletal muscle mass](https://doi.org/10.1152/jappl.2000.89.1.81), [larger lung sizes](https://dx.doi.org/10.1016%2Fj.tem.2007.08.003), etc.. just to name a few), there continues to be a [_significant gender gap_](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3761733) in performance in most sports at the top competitive level.

The same gender gap also exists in [games like chess](https://theconversation.com/whats-behind-the-gender-imbalance-in-top-level-chess-150637) where it is less clear why this difference exists. Does the discrepancy mean that men are actually better at chess than women?

Dr. Wei Ji Ma refuted this idea in a [**recent article**](https://en.chessbase.com/post/what-gender-gap-in-chess), arguing that _**participation level largely accounts for the observed differences**_ in ratings of top chess players. Since women are so underrepresented in chess (between $5\%$ and $15\%$ depending on inclusion criteria (location, rating, age, etc.)), there is just simply a much lower chance of having female players who are as good as the top male players (similar to how in a longer sequence of coin flips, there are just more chances of having longer runs than in a shorter sequence).

Using official [ELO rating](https://en.wikipedia.org/wiki/Elo_rating_system) data for Indian players obtained from [FIDE](https://en.wikipedia.org/wiki/FIDE) (the international governing body for chess), he performed a **permutation test** that showed participation level _**can indeed largely account for the observed gender gap**_. For this exercise, you will reproduce his results for American players.



a. _**Download**_ a (slightly preprocessed) [data frame of the current FIDE standard (tournament) format ELO ratings](chess.csv.gz). Import it normally using `read_csv` (`.csv.gz` just means it's a [csv that was compressed](https://www.rdocumentation.org/packages/R.utils/versions/1.9.6/topics/gzip) to save space; _you can ignore this_ since most functions in _R will automagically decompress and read them_, so no extra work needed), and check it was correctly read by inspecting the first few rows with `head()`.

```{r}
# DO THIS: uncomment the lines below and complete them
# 
# ratings.standard = read_csv(...)
# head(...)
```



b. _**Make a table**_ showing the number of players, mean rating, and highest rating for each sex. (**Hint:** this can be easily done in one `dplyr` step; use `group_by` followed by a `summarise` with 3 values). Note this is being done on all the raw data.

```{r}
# DO THIS: uncomment the lines below and complete them
# 
# ratings.standard %>% 
#   group_by(...) %>% 
#   summarise(num  = ... ,  # for help, see dplyr.tidyverse.org/reference/n.html
#             mean = ... ,
#             max  = ... ,)
```



c. Ma points out junior players (**born on or after 2000**) may have unreliable ratings. _**Remove these players**_ from the data frame. Also _**remove non-US**_ players, as we are interested in analyzing American players.
  
  Then, _**make a density plot**_ of players' ratings, showing the male and female players as separate curves in the same plot window. Do they look very different?

```{r}
# DO THIS: uncomment lines below and complete them
# note & can be used to filter 2 criteria (bday and country)
# 
# ratings.standard.us = ratings.standard %>% 
#   filter(... & ...)
# 
# ggplot(ratings.standard.us, aes(x=... , color=...)) + geom_density()

# don't forget to add appropriate title/axes!!
```



d. Let the **null hypothesis** be that there is no actual gender gap in performance, i.e. that _**sex does not influence ratings**_. Assuming this is true, then we should be able to **permute** the variables in the sex column and recompute  Write a function `permutedMaxSexDiff(df,n)` that, given a data frame `df` and a number of iterations `n`,


---



## Submission

As usual, make sure the **names of everyone** who worked on this with you is included in the header of this document. Then, **knit this document** and submit **both this file and the HTML output** on Canvas under Assignments â‡’ Discussion 4
